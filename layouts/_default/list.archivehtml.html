{{ define "main" }}
	{{ $list := (where .Site.Pages "Type" "post") }}
	<section class="h-feed">
		<h1>Archive</h1>
        <quiet-search-list match="custom" id="search-list__custom">
        <!-- Controller -->
            <quiet-text-field 
                slot="controller" 
                label="Search posts"
                description="Add @indoor or @outdoor to filter by category"
                type="search" 
                with-clear
                pill
            >
                <quiet-icon slot="start" name="search"></quiet-icon>
            </quiet-text-field>

            {{ range $list }}
            <div class="item h-entry" data-category="indoor">
                <h4 class="p-name"><a href="{{ .Permalink }}" class="u-url">{{ .Title }}</a></h4>
                <p class="p-summary">{{ .Summary | truncate 100 }}</p>
                <cite><time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05-0700" }}">{{ .Date.Format "2 Jan 06" }}</time></cite>
            </div>
            {{ end }}

            <!-- Empty state -->
            <quiet-empty-state slot="empty">
                <quiet-icon slot="illustration" name="cat"></quiet-icon>
                <h4>No posts match your search</h4>
                <p><small>Try searching by name or using the @indoor or @outdoor tags</small></p>
            </quiet-empty-state>
        </quiet-search-list>
	</section>



<script>
  const searchList = document.getElementById('search-list__custom');

  // A very contrived custom match function
  searchList.isMatch = (query, content, el) => {
    query = query.toLowerCase().trim();

    // If no query, show all items
    if (!query) return true;

    const environment = el.getAttribute('data-environment');
    const envMatch = query.match(/@(indoor|outdoor)/);

    // Look for @indoor or @outdoor in the query
    if (envMatch) {
      // Remove the environment tag from the query for text search
      const searchEnvironment = envMatch[1];
      const textQuery = query.replace(/@(indoor|outdoor)/, '').trim();

      // Must match both environment and text (if any text remains)
      return environment === searchEnvironment && (!textQuery || content.toLowerCase().includes(textQuery));
    }

    // If no environment tag was found, fall back to text search
    return content.toLowerCase().includes(query);
  };
</script>

<style>
  #search-list__custom {
    &::part(items) {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(min(200px, 100%), 1fr));
      gap: 1rem;
    }

    .item {
      border: var(--quiet-border-style) var(--quiet-border-width) var(--quiet-neutral-stroke-softer);
      border-radius: var(--quiet-border-radius-md);
      background-color: var(--quiet-paper-color);
      box-shadow: var(--quiet-shadow-softer);
      padding: 1rem;

      h4 {
        margin: 0;
        font-size: 1.125rem;
      }

      p {
        color: var(--quiet-text-muted);
        margin: 0.5rem 0;
        font-size: 0.875rem;
        margin-block-end: 0;
      }
    }

    div[slot="empty"] {
      text-align: center;
      color: var(--quiet-text-muted);
      margin-block-start: 1rem;
      
      quiet-icon {
        font-size: 2.5rem;
        stroke-width: 1px;
      }

      small {
        display: block;
        margin-top: 0.5rem;
      }
    }
  }
</style>
{{ end }}