{{ define "main" }}
<div>
    <quiet-typewriter 
        text="Fleeting" 
        speed="100"
        delay="250"
        style="font-size: 2rem; font-weight: var(--quiet-font-weight-bold);"
        ></quiet-typewriter>
    <div class="h-feed">
        <quiet-random-content unique style="display: flex; flex-direction: column; gap: 1rem;" id="random__overview">
            {{ $pages := (where .Site.Pages.ByLastmod.Reverse "Type" "post") }}
            {{- $paginator := .Paginate $pages (index .Site.Params "archive-paginate" | default 20) }}
            {{- range $paginator.Pages  }}
            {{ if .Title }}
            {{ else }}
            <quiet-card class="e-content" orientation="horizontal" id="card__orientation">
                {{ .Content }}
                <cite><a href="{{ .Permalink }}" class="u-url"><time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05-0700" }}">Published {{ .Date.Format "2 Jan 06" }}</time></a></cite>
            </quiet-card>
            {{ end }}
            {{ end }}
        </quiet-random-content>  
        <quiet-button class="mt" evt-click="randomize" appearance="text" icon-label="Shuffle" pill>
            Shuffle <quiet-icon evt-click="randomize" name="arrows-shuffle"></quiet-icon>
        </quiet-button>   
    </div>
    <quiet-typewriter 
            text="Recently updated posts" 
            speed="100"
            delay="1050"
            style="font-size: 2rem; font-weight: var(--quiet-font-weight-bold);"
            ></quiet-typewriter>
    <div class="mt h-feed">
        {{ $pages := (where .Site.Pages.ByLastmod.Reverse "Type" "post") }}
        {{- $paginator := .Paginate $pages (index .Site.Params "archive-paginate" | default 20) }}
        {{- range $paginator.Pages  }}
        {{ if .Title}}
        <div class="item long-post h-entry">
            <h4><a href="{{ .Permalink }}" class="u-url">{{ .Title }}</a></h4>
            <div class="p-summary">
            {{ if .Summary}}
            {{ .Summary }}
            {{ else }}
            {{ .Content | strings.Truncate 400 }}
            {{ end }}
            </div>
            <cite><time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05-0700" }}">Published {{ .Date.Format "2 Jan 06" }}</time></cite>
        </div>
        {{ end }}
        {{ end }}
    </div>
    <a id="more" href="/archive">View all <quiet-icon name="arrow-right"></quiet-icon></a>
</div>
<script>
  document.querySelectorAll('quiet-random-content quiet-card').forEach(item => { 
    var img = item.querySelector('img');
    if(img && !img.classList.contains('video-thumbnail')) {
        img.setAttribute('slot','media');
        item.prepend(img);
    } else {
        item.insertAdjacentHTML('afterbegin',`<quiet-avatar slot="header" image="{{ .Site.Author.avatar }}"></quiet-avatar>`);
    }
  });
  const randomList = document.getElementById('random__overview');
  document.addEventListener('click', (event) => {
    if(event.target.getAttribute('evt-click') == 'randomize'){
        randomList.randomize();
    }
  });
</script>
{{ end }}